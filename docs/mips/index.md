# MIPS 指令集参考

本课程所要求实现的 MIPS 指令集为 MIPS I 的子集（以下简称 MIPS）。

MIPS 是一种简单指令集（RISC）。在 MIPS 中，通用寄存器与地址线宽度均为 32 位，指令长度也为定长的 32 位。我们称 32 位为一个**字（word）**，注意这一点与 x86 上称 16 位为一个字不同。

为了减少分支指令对流水线的阻塞（或减少分支预测失败时的代价，如果有），MIPS 使用**延迟分支**（delayed branching）。即，位于分支指令之后的下一条指令（称为「分支延迟槽」，delay slot），无论根据分支条件是否将发生跳转，均会作为分支指令的后一条指令被执行，而跳转实际上发生在该指令执行之后。由于该功能是为了多周期流水线而设计，在单周期 CPU 的任务中我们不实现该功能。

作为一种简单指令集，MIPS 基于加载-存储架构（load-store architecture），即，内存读写操作需要专门的指令来完成，而运算操作仅在寄存器中完成。与之相匹配，MIPS 拥有多达 32 个通用寄存器，这使得编译器能够更有效地优化局部运算。

## 编码

在 MIPS 中，指令共有三种编码方式：

<table style="width: 100%; ">
  <thead>
    <tr>
      <th style="text-align: center; vertical-align: middle; " rowspan="2">名称</th>
      <th style="text-align: center; vertical-align: middle; " colspan="6">字段列表</th>
      <th style="text-align: center; vertical-align: middle; " rowspan="2">解释</th>
    </tr>
    <tr>
      <th style="text-align: center; vertical-align: middle; ">[31:26]</th>
      <th style="text-align: center; vertical-align: middle; ">[25:21]</th>
      <th style="text-align: center; vertical-align: middle; ">[20:16]</th>
      <th style="text-align: center; vertical-align: middle; ">[15:11]</th>
      <th style="text-align: center; vertical-align: middle; ">[10:6]</th>
      <th style="text-align: center; vertical-align: middle; ">[5:0]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th style="text-align: center; vertical-align: middle; ">R 型指令</th>
      <td style="text-align: center; vertical-align: middle; ">操作码<br><code>op</code><br>6 位</td>
      <td style="text-align: center; vertical-align: middle; ">源寄存器<br><code>rs</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; ">源寄存器<br><code>rt</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; ">目标寄存器<br><code>rd</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; ">移位量<br><code>shamt</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; ">功能码<br><code>funct</code><br>6 位</td>
      <td style="text-align: center; vertical-align: middle; ">以两个寄存器为源中的算术/位运算指令；移位指令。</td>
    </tr>
    <tr>
      <th style="text-align: center; vertical-align: middle; ">I 型指令</th>
      <td style="text-align: center; vertical-align: middle; ">操作码<br><code>op</code><br>6 位</td>
      <td style="text-align: center; vertical-align: middle; ">源寄存器<br><code>rs</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; ">源寄存器<br><code>rt</code><br>5 位</td>
      <td style="text-align: center; vertical-align: middle; " colspan="3">地址 / 立即数<br><code>addr / imme</code><br>16 位</td>
      <td style="text-align: center; vertical-align: middle; ">带立即数的运算指令；分支指令；访存指令。</td>
    </tr>
    <tr>
      <th style="text-align: center; vertical-align: middle; ">J 型指令</th>
      <td style="text-align: center; vertical-align: middle; ">操作码<br><code>op</code><br>6 位</td>
      <td style="text-align: center; vertical-align: middle; " colspan="5">跳转地址<br><code>jmpaddr</code><br>26 位</td>
      <td style="text-align: center; vertical-align: middle; ">跳转指令。</td>
    </tr>
  </tbody>
</table>

在本文档的指令解释中，将会直接使用此处定义的字段名。

## Verilog 表达式参考

下表给出了每一条指令与对应的 Verilog 表达式（可使用 `case` 或 `inside` 进行判断）。

|指令|Verilog 表达式|
|:--:|:--:|
|ADD|`32'b000000_????????????????????_100000`|
|ADDU|`32'b000000_????????????????????_100001`|
|SUB|`32'b000000_????????????????????_100010`|
|SUBU|`32'b000000_????????????????????_100011`|
|AND|`32'b000000_????????????????????_100100`|
|OR|`32'b000000_????????????????????_100101`|
|XOR|`32'b000000_????????????????????_100110`|
|NOR|`32'b000000_????????????????????_100111`|
|SLL|`32'b000000_????????????????????_000000`|
|SRL|`32'b000000_????????????????????_000010`|
|SRA|`32'b000000_????????????????????_000011`|
|SLLV|`32'b000000_????????????????????_000100`|
|SRLV|`32'b000000_????????????????????_000110`|
|SRAV|`32'b000000_????????????????????_000111`|
|SLT|`32'b000000_????????????????????_101010`|
|SLTU|`32'b000000_????????????????????_101011`|
|MULT|`32'b000000_????????????????????_011000`|
|MULTU|`32'b000000_????????????????????_011001`|
|DIV|`32'b000000_????????????????????_011010`|
|DIVU|`32'b000000_????????????????????_011011`|
|MFHI|`32'b000000_????????????????????_010000`|
|MFLO|`32'b000000_????????????????????_010010`|
|MTHI|`32'b000000_????????????????????_010001`|
|MTLO|`32'b000000_????????????????????_010011`|
|ADDI|`32'b001000_????????????????????_??????`|
|ADDIU|`32'b001001_????????????????????_??????`|
|ANDI|`32'b001100_????????????????????_??????`|
|ORI|`32'b001101_????????????????????_??????`|
|XORI|`32'b001110_????????????????????_??????`|
|SLTI|`32'b001010_????????????????????_??????`|
|SLTIU|`32'b001011_????????????????????_??????`|
|LUI|`32'b001111_????????????????????_??????`|
|LW|`32'b100011_????????????????????_??????`|
|LH|`32'b100001_????????????????????_??????`|
|LHU|`32'b100101_????????????????????_??????`|
|LB|`32'b100000_????????????????????_??????`|
|LBU|`32'b100100_????????????????????_??????`|
|SW|`32'b101011_????????????????????_??????`|
|SH|`32'b101001_????????????????????_??????`|
|SH|`32'b101000_????????????????????_??????`|
|BEQ|`32'b000100_????????????????????_??????`|
|BNE|`32'b000101_????????????????????_??????`|
|BLTZ|`32'b000001_?????00000??????????_??????`|
|BLEZ|`32'b000110_?????00000??????????_??????`|
|BGTZ|`32'b000111_?????00000??????????_??????`|
|BGEZ|`32'b000001_?????00001??????????_??????`|
|J|`32'b000010_????????????????????_??????`|
|JAL|`32'b000011_????????????????????_??????`|
|JR|`32'b000000_????????????????????_001000`|
|JALR|`32'b000000_????????????????????_001001`|
|SYSCALL|`32'b000000_????????????????????_001100`|
